---

# Main collection of env. vars to set for all tasks and scripts.
env:
    ####
    #### Cache-image names to test with (double-quotes around names are critical)
    ####
    FEDORA_NAME: "fedora-40"
    FEDORA_AARCH64_NAME: "${FEDORA_NAME}-aarch64"

    # Image identifiers
    IMAGE_SUFFIX: "c20241016t144444z-f40f39d13"

    # EC2 images
    FEDORA_AMI: "fedora-aws-${IMAGE_SUFFIX}"
    FEDORA_AARCH64_AMI: "fedora-podman-aws-arm64-${IMAGE_SUFFIX}"

    # directory where the images will be placed
    OUTDIR: "outdir"

    GOPATH: "/var/tmp/go"
    GOCACHE: "${GOPATH}/cache"
    HOME: /root
    CIRRUS_WORKING_DIR: /var/tmp/podman-machine-os

aws_credentials: ENCRYPTED[b01991b35fe3f81eed974cf47b5541ed518eacfee4e430e9fb50fba31090f557ea86b0b79b5f5b4a712218206e0f3f58]


image_build_x86_64_task:
    name: "Image Build x86_64"
    alias: "image_build_x86_64"
    ec2_instance:
        image: "${FEDORA_AMI}"
        type: "${EC2_INST_TYPE}"
        region: us-east-1
    env:
      EC2_INST_TYPE: "m5zn.metal"  # Bare-metal instance is required
    setup_script: &setup ./contrib/cirrus/setup.sh
    build_script: &build ./build.sh
    verify_script: &verify ./contrib/cirrus/verify.sh
    image_artifacts: &image_artifacts
        path: "$OUTDIR/*.zst"
        type: application/octet-stream


image_build_aarch64_task:
    name: "Image Build aarch64"
    alias: "image_build_aarch64"
    ec2_instance:
        image: "${FEDORA_AARCH64_AMI}"
        type: "${EC2_INST_TYPE}"
        region: us-east-1
    env:
      EC2_INST_TYPE: "c6g.metal"  # Bare-metal instance is required
    setup_script: *setup
    build_script: *build
    verify_script: *verify
    image_artifacts: *image_artifacts

test_task:
    name: "Total Success"
    alias: success
    depends_on:
        - image_build_x86_64
        - image_build_aarch64
    container:
        image: quay.io/libpod/testimage:20241011
        cpu: 1
        memory: 1
    noop_script: true
